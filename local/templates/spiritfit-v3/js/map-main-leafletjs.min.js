let mapL,markers=[];document.addEventListener("DOMContentLoaded",function(){let s=55.753484,c=37.622615,r=(markers=[],null);void 0!==window.cord&&(s=window.cord[0],c=window.cord[1]);var o=window.innerWidth<650?9:10,o={center:[s,c],zoom:o,zoomControl:!1,gestureHandling:!0},o=(mapL=new L.map("mapid",o),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{}).addTo(mapL),"/local/templates/spiritfit-v3/img/icons/");let a=o+"map-marker-icon.png",l=o+"map-marker-icon-active.png",p=[20,47];window.innerWidth<800&&(a=o+"map-marker-icon-small.png",l=o+"map-marker-icon-small-active.png",p=[12.5,29]);var t=window.clubs;let d="265";const m=$(".b-map__info-title"),_=$(".b-map__contacts"),u=$(".b-map__button_link");function n(e){var i=L.icon({iconUrl:l,iconAnchor:p}),t=L.icon({iconUrl:a,iconAnchor:p}),o=L.divIcon({html:"",className:"invisible-icon",iconSize:[0,0]});if($(".b-map__info-plate").hasClass("hidden")){$(".b-map__info-plate").removeClass("hidden");{let e=window.innerWidth,i=e/7;e<1e3&&(i=e/6);e<640&&(i=e/6);mapL.panBy([-i,0])}}if(e==d)for(var n=0;n<markers.length;n++)markers[n].options.id==d?markers[n].setIcon(o):markers[n].setIcon(i);else{for(n=0;n<markers.length;n++)markers[n].options.isActive&&(markers[n].setZIndexOffset(-1e3),markers[n].options.isActive=!1),markers[n].options.id==d?markers[n].setIcon(o):markers[n].setIcon(t);e.setZIndexOffset(1e3),e.setIcon(i),e.options.isActive=!0}}function h(e){let i=e.options.phone.replace(/\D/gi,""),t=("+"===e.options.phone[0]&&(i="+"+i),""),o="",n=("Y"==e.options.club_soon_open||""===e.options.page?(m.html("<span>"+e.options.title+"</span>"),u.addClass("is-hide").attr("href","#")):(m.html("<a href='"+e.options.page+"'>"+e.options.title+"</a>"),u.removeClass("is-hide").attr("href",e.options.page),t=`<div class="b-map__contact-item">
              <a href="${e.options.page}#timetable">Расписание</a>
	  </div>`,void 0!==e.options.minPrice&&0<e.options.minPrice&&(o=`<div class="b-map__min-price" style="font-weight: 500">Ежемесячный платеж <span>от ${e.options.minPrice} <span class="rub">₽</span></span></div>`)),"");0<e.options.description.length&&(n=`
      <div class="b-map__contact-item-descr-wrapper">
          <div class="b-map__contact-item-descr">${e.options.description}</div>`,1024<$(window).width()&&(n+='<a class="b-map__contact-item-descr-more" href="#">Подробнее</a>'),n+="</div>",$(".b-map__contact-full-descr").html(e.options.description+'<a class="b-map__contact-full-close" href="#"></a>'),r=e.options.description);var a=e.options.workHours.map(function(e){return`<div>${e}</div>`}).join(""),e=`${n}
    <div data-coord-x="${s}" data-coord-y="${c}" class="b-map__contact-item">
        ${e.options.address}
    </div>
    <div class="b-map__contact-item">
        <div><a href="tel:${i}" class="invisible-link" onclick="dataLayerSend('UX','clickCallButton', document.location.protocol+'//'+document.location.host+document.location.pathname);">${e.options.phone}</a></div>
        <div><a href="mailto:${e.options.email}" class="invisible-link">${e.options.email}</a></div>
    </div>
    <div class="b-map__contact-item">${a}</div>`+t+o;_.html(e)}if($(".b-map__map-wrap").after(`
    <div class="b-map__contact-full-descr-wrapper" style="display:none">
        <div class="b-map__contact-full-descr"></div>
        <div class="b-map__contact-full-descr-bg"></div>
        
    </div>
    `),$(".b-map__info-plate").click(function(e){e.target.classList.contains("b-map__contact-item-descr-more")&&(e.preventDefault(),$(window).width()<=1024?$(".b-map__contact-item-descr").html(r):$(".b-map__contact-full-descr-wrapper").fadeIn(300))}),$(".b-map__contact-full-descr-wrapper").click(function(e){(e.target.classList.contains("b-map__contact-full-descr-bg")||e.target.classList.contains("b-map__contact-full-close"))&&(e.preventDefault(),$(".b-map__contact-full-descr-wrapper").fadeOut(300))}),void 0!==window.club){o=L.icon({iconUrl:l,iconAnchor:p}),o=L.marker([+s,+c],{id:window.club.id,itemCords:[s,s],name:window.club.name,title:window.club.name,address:window.club.address,phone:window.club.phone,email:window.club.email,workHours:window.club.workHours,page:window.club.page,icon:o,map:mapL,description:window.club.description,minPrice:window.club.min_price});o.addTo(mapL),markers.push(o)}else for(let i=0;i<t.length;i++){var f="",b="",b=0<t[i].coords[0].length?(f=+t[i].coords[0],+t[i].coords[1]):(f=s,c),w=1<t.length?a:l;let e=L.icon({iconUrl:w,iconAnchor:p});t[i].id==d&&(e=L.divIcon({html:"",className:"invisible-marker-icon",iconSize:[0,0]}));w=L.marker([f,b],{id:t[i].id,itemCords:[f,b],name:t[i].name,title:t[i].title,address:t[i].address,phone:t[i].phone,email:t[i].email,workHours:t[i].workHours,page:t[i].page,icon:e,map:mapL,description:t[i].description,club_not_open:t[i].club_not_open,club_soon_open:t[i].club_soon_open,isActive:!1,minPrice:t[i].min_price});w.on("click",function(e){n(e.target),h(e.target)}),w.addTo(mapL),markers.push(w)}$(".b-map__switch").on("select2:select",function(){$(".b-map__switch-holder .select2-results__options").getNiceScroll().hide();const i=$(":selected",$(this)).val();var e=markers.find(function(e){return e.options.id===i});i==d?n(d):(mapL.panTo(e.getLatLng()),n(e)),h(e)}),$(".b-map__switch").on("select2:opening",function(){dataLayerSend("UX","useClubSearchForm","mainPage")});{let i=0,t="",e=decodeURI(document.location.href);if(-1!==e.indexOf("?")){let i=(e=e.split("?"))[1];if(-1!==i.indexOf("&")){i=i.split("&");for(let e=0;e<i.length;e++)if(i[e]=i[e].split("="),"club"==i[e][0]){t=i[e][1];break}}else"club"==(i=i.split("="))[0]&&(t=i[1])}0<t.length&&(-1!==t.indexOf("+")&&(t=t.replaceAll("+"," ")),$("select.b-map__switch option").each(function(){$(this).text().toLowerCase()==t.toLowerCase()&&(i=$(this).val())}),$("select.b-map__switch").val(i),$("select.b-map__switch").trigger("change"),void 0!==(o=markers.find(function(e){return e.options.id===i}))&&(mapL.panTo(o.getLatLng()),n(o),h(o)))}$(".b-map__info-plate-closer").click(function(){$(".b-map__info-plate").fadeOut(300,function(){$(this).addClass("hidden"),$(this).removeAttr("style")})})});